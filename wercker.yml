box:
  id: tamakiii/qmk_firmware:latest

build:
  steps:
    - add-ssh-key:
      keyname: $GITHUB_SSH_KEY_NAME
      host: github.com

    - add-to-known_hosts:
      hostname: github.com
      fingerprint: 16:27:ac:a5:76:28:2d:36n:63:1b:56:4d:eb:df:a6:48

    - script:
      name: setup
      code: make setup

    - script:
      name: build keymap
      cwd: $WERCKER_SOURCE_DIR/vendor/qmk/qmk_firmware
      code: |
        make keyboard=$KEYBOARD subproject=$SUBPROJECT keymap=$KEYMAP

    - script:
      name: move built firmware to output dir.
      cwd: $WERCKER_SOURCE_DIR/vendor/qmk/qmk_firmware/.build
      code: |
        cp *.hex $WERCKER_OUTPUT_DIR/

deploy:
  steps:
    - script:
      name: upload hex file
      cwd: $WERCKER_OUTPUT_DIR
      code:
        which curl && echo $DROPBOX_DIR && pwd && ls -lsa && for FILE in .; do echo ${FILE}; done
